using UnityEngine;

public class PlayerAiming : MonoBehaviour
{
    // Reference to the main camera used to cast rays from the mouse position
    public Camera cam;

    // Layer mask so the ray only hits objects you mark as "Ground"
    public LayerMask groundMask;

    // Reference to the generated Input System class
    GameInputs input;

    // Stores the current look / aim input (mouse position or right-stick)
    Vector2 lookInput;

    void Awake()
    {
        // Create an instance of the input actions asset
        input = new GameInputs();

        // When Look input is active, store the current value (screen position / stick)
        input.Player.Look.performed += ctx => lookInput = ctx.ReadValue<Vector2>();

        // When the Look input stops, reset the value to zero
        input.Player.Look.canceled += ctx => lookInput = Vector2.zero;
    }

    // Enable inputs when this object becomes active
    void OnEnable() => input.Enable();

    // Disable inputs when the object becomes inactive
    void OnDisable() => input.Disable();

    void Update()
    {
        // Convert the screen-space look input into a ray coming from the camera
        // going through the mouse/stick position on the screen
        Ray ray = cam.ScreenPointToRay(lookInput);

        // Cast the ray into the scene and check if it hits something on the ground layer
        if (Physics.Raycast(ray, out RaycastHit hit, 100f, groundMask))
        {
            // World-space point on the ground where the ray hit
            Vector3 lookPoint = hit.point;

            // Direction from the player to the hit point
            Vector3 dir = (lookPoint - transform.position);

            // Ignore vertical tilt â€” we only want horizontal rotation
            dir.y = 0;

            // Only rotate if the direction is meaningful (avoids jitter at very small distances)
            if (dir.sqrMagnitude > 0.001f)
                transform.rotation = Quaternion.LookRotation(dir);
        }
    }
}
