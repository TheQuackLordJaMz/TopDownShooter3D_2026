using UnityEngine;

// Makes sure the GameObject always has a Rigidbody component.
// If it's missing, Unity will automatically add one.
[RequireComponent(typeof(Rigidbody))]
public class PlayerMovementInput : MonoBehaviour
{
    // Player movement speed (editable in Inspector)
    [SerializeField] private float speed = 6f;

    // Reference to the Rigidbody used for physics-based movement
    Rigidbody rb;

    // Reference to the C# class generated by the Unity Input System
    GameInputs input;

    // Stores the movement input coming from keyboard / gamepad
    // X = horizontal, Y = vertical
    Vector2 moveInput;

    // Called when the script instance is first created
    void Awake()
    {
        // Cache the Rigidbody component so we don't repeatedly call GetComponent
        rb = GetComponent<Rigidbody>();

        // Create a new instance of the input actions asset
        input = new GameInputs();

        // When the Movement action is performed (WASD / Stick moved),
        // read the input as a Vector2 and store it in moveInput
        input.Player.Movement.performed += ctx => moveInput = ctx.ReadValue<Vector2>();

        // When the Movement input is released, reset movement back to zero
        input.Player.Movement.canceled += ctx => moveInput = Vector2.zero;
    }

    // Enable the input system when this object becomes active
    void OnEnable() => input.Enable();

    // Disable input when the object is inactive (prevents ghost input)
    void OnDisable() => input.Disable();

    // FixedUpdate is used for physics movement (runs at a fixed timestep)
    void FixedUpdate()
    {
        // Convert the 2D input vector into a 3D direction (XZ plane)
        Vector3 dir = new Vector3(moveInput.x, 0, moveInput.y);

        // Move the Rigidbody using physics-safe movement
        // dir.normalized ensures diagonal movement isn't faster
        rb.MovePosition(
            rb.position +
            dir.normalized * speed * Time.fixedDeltaTime
        );
    }
}
